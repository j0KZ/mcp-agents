# Docker Compose for MCP Agents with Docker MCP Gateway
# Usage: docker compose -f docker-compose.mcp.yml up -d
#
# This configuration provides:
# - Docker MCP Gateway for dynamic tool discovery
# - All 10 MCP servers containerized
# - Isolated network for secure communication

services:
  # Docker MCP Gateway - single entry point for all MCP tools
  mcp-gateway:
    image: docker/mcp-gateway:latest
    ports:
      - "8811:8811"
    volumes:
      - ./docker/mcp-config:/config:ro
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - MCP_CONFIG_PATH=/config/servers.json
    restart: unless-stopped

  # Smart Reviewer - AI-powered code review
  smart-reviewer:
    build:
      context: .
      dockerfile: docker/base.Dockerfile
      args:
        PACKAGE_NAME: smart-reviewer
    labels:
      - "mcp.server=true"
      - "mcp.name=smart-reviewer"
      - "mcp.description=AI-powered code review with security analysis"
      - "mcp.category=analysis"
    restart: unless-stopped

  # Test Generator - comprehensive test suite generation
  test-generator:
    build:
      context: .
      dockerfile: docker/base.Dockerfile
      args:
        PACKAGE_NAME: test-generator
    labels:
      - "mcp.server=true"
      - "mcp.name=test-generator"
      - "mcp.description=Generate comprehensive test suites with edge cases"
      - "mcp.category=generation"
    restart: unless-stopped

  # Architecture Analyzer - dependency and structure analysis
  architecture-analyzer:
    build:
      context: .
      dockerfile: docker/base.Dockerfile
      args:
        PACKAGE_NAME: architecture-analyzer
    labels:
      - "mcp.server=true"
      - "mcp.name=architecture-analyzer"
      - "mcp.description=Dependency analysis, circular detection, layer violations"
      - "mcp.category=analysis"
    restart: unless-stopped

  # Security Scanner - OWASP and vulnerability scanning
  security-scanner:
    build:
      context: .
      dockerfile: docker/base.Dockerfile
      args:
        PACKAGE_NAME: security-scanner
    labels:
      - "mcp.server=true"
      - "mcp.name=security-scanner"
      - "mcp.description=OWASP Top 10, secret detection, vulnerability scanning"
      - "mcp.category=security"
    restart: unless-stopped

  # Refactor Assistant - code transformation tools
  refactor-assistant:
    build:
      context: .
      dockerfile: docker/base.Dockerfile
      args:
        PACKAGE_NAME: refactor-assistant
    labels:
      - "mcp.server=true"
      - "mcp.name=refactor-assistant"
      - "mcp.description=Extract functions, simplify conditionals, apply design patterns"
      - "mcp.category=refactoring"
    restart: unless-stopped

  # API Designer - REST/GraphQL API design
  api-designer:
    build:
      context: .
      dockerfile: docker/base.Dockerfile
      args:
        PACKAGE_NAME: api-designer
    labels:
      - "mcp.server=true"
      - "mcp.name=api-designer"
      - "mcp.description=REST/GraphQL API design with OpenAPI generation"
      - "mcp.category=design"
    restart: unless-stopped

  # DB Schema Designer - database schema design
  db-schema:
    build:
      context: .
      dockerfile: docker/base.Dockerfile
      args:
        PACKAGE_NAME: db-schema
    labels:
      - "mcp.server=true"
      - "mcp.name=db-schema"
      - "mcp.description=Database schema design for PostgreSQL, MySQL, MongoDB"
      - "mcp.category=design"
    restart: unless-stopped

  # Doc Generator - documentation generation
  doc-generator:
    build:
      context: .
      dockerfile: docker/base.Dockerfile
      args:
        PACKAGE_NAME: doc-generator
    labels:
      - "mcp.server=true"
      - "mcp.name=doc-generator"
      - "mcp.description=JSDoc, README, API docs, and changelog generation"
      - "mcp.category=generation"
    restart: unless-stopped

  # Orchestrator - workflow coordination
  orchestrator-mcp:
    build:
      context: .
      dockerfile: docker/base.Dockerfile
      args:
        PACKAGE_NAME: orchestrator-mcp
    labels:
      - "mcp.server=true"
      - "mcp.name=orchestrator"
      - "mcp.description=Chain multiple MCP tools into workflows"
      - "mcp.category=orchestration"
    depends_on:
      - smart-reviewer
      - test-generator
      - security-scanner
    restart: unless-stopped

  # Auto-Pilot - zero-effort automation
  auto-pilot:
    build:
      context: .
      dockerfile: docker/base.Dockerfile
      args:
        PACKAGE_NAME: auto-pilot
    labels:
      - "mcp.server=true"
      - "mcp.name=auto-pilot"
      - "mcp.description=Zero-effort automation for lazy developers"
      - "mcp.category=automation"
    restart: unless-stopped

networks:
  default:
    name: mcp-network
