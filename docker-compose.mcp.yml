# Docker Compose for MCP Agents
#
# Usage:
#   1. Build images: docker compose -f docker-compose.mcp.yml build
#   2. The gateway launches containers on-demand (no need to run 'up')
#   3. Configure Claude Code to use the gateway (see .mcp.json)
#
# The Docker MCP Gateway will automatically start/stop containers as needed.

services:
  # MCP Server Images - built but not run continuously
  # The gateway launches these on-demand when tools are called

  smart-reviewer:
    build:
      context: .
      dockerfile: docker/base.Dockerfile
      args:
        PACKAGE_DIR: smart-reviewer
        PACKAGE_SCOPE: smart-reviewer-mcp
        MCP_DESCRIPTION: "AI-powered code review with security analysis"
    image: mcp-agents-smart-reviewer:latest
    profiles: ["build-only"]

  test-generator:
    build:
      context: .
      dockerfile: docker/base.Dockerfile
      args:
        PACKAGE_DIR: test-generator
        PACKAGE_SCOPE: test-generator-mcp
        MCP_DESCRIPTION: "Generate comprehensive test suites with edge cases"
    image: mcp-agents-test-generator:latest
    profiles: ["build-only"]

  architecture-analyzer:
    build:
      context: .
      dockerfile: docker/base.Dockerfile
      args:
        PACKAGE_DIR: architecture-analyzer
        PACKAGE_SCOPE: architecture-analyzer-mcp
        MCP_DESCRIPTION: "Dependency analysis, circular detection, layer violations"
    image: mcp-agents-architecture-analyzer:latest
    profiles: ["build-only"]

  security-scanner:
    build:
      context: .
      dockerfile: docker/base.Dockerfile
      args:
        PACKAGE_DIR: security-scanner
        PACKAGE_SCOPE: security-scanner-mcp
        MCP_DESCRIPTION: "OWASP Top 10, secret detection, vulnerability scanning"
    image: mcp-agents-security-scanner:latest
    profiles: ["build-only"]

  refactor-assistant:
    build:
      context: .
      dockerfile: docker/base.Dockerfile
      args:
        PACKAGE_DIR: refactor-assistant
        PACKAGE_SCOPE: refactor-assistant-mcp
        MCP_DESCRIPTION: "Extract functions, simplify conditionals, apply design patterns"
    image: mcp-agents-refactor-assistant:latest
    profiles: ["build-only"]

  api-designer:
    build:
      context: .
      dockerfile: docker/base.Dockerfile
      args:
        PACKAGE_DIR: api-designer
        PACKAGE_SCOPE: api-designer-mcp
        MCP_DESCRIPTION: "REST/GraphQL API design with OpenAPI generation"
    image: mcp-agents-api-designer:latest
    profiles: ["build-only"]

  db-schema:
    build:
      context: .
      dockerfile: docker/base.Dockerfile
      args:
        PACKAGE_DIR: db-schema
        PACKAGE_SCOPE: db-schema-mcp
        MCP_DESCRIPTION: "Database schema design for PostgreSQL, MySQL, MongoDB"
    image: mcp-agents-db-schema:latest
    profiles: ["build-only"]

  doc-generator:
    build:
      context: .
      dockerfile: docker/base.Dockerfile
      args:
        PACKAGE_DIR: doc-generator
        PACKAGE_SCOPE: doc-generator-mcp
        MCP_DESCRIPTION: "JSDoc, README, API docs, and changelog generation"
    image: mcp-agents-doc-generator:latest
    profiles: ["build-only"]

  orchestrator-mcp:
    build:
      context: .
      dockerfile: docker/base.Dockerfile
      args:
        PACKAGE_DIR: orchestrator-mcp
        PACKAGE_SCOPE: orchestrator-mcp
        MCP_DESCRIPTION: "Chain multiple MCP tools into workflows"
    image: mcp-agents-orchestrator-mcp:latest
    profiles: ["build-only"]

networks:
  default:
    name: mcp-network
